{
	# Disable admin endpoint for safety
	admin off
	# Enable basic logging to stdout
	log {
		output stdout
		format console
	}
}

:{$PORT}

encode zstd gzip

# Security and embed headers
header {
	-X-Frame-Options
	Content-Security-Policy "frame-ancestors 'self' *"
	Referrer-Policy "no-referrer"
	X-Content-Type-Options "nosniff"
}

# Health endpoint
@health path /healthz
handle @health {
	root * /srv
	file_server browse false
	try_files {path} /healthz.txt
}

# Landing page at /landing
@landing path /landing
handle @landing {
	root * /srv
	file_server browse false
	try_files {path} /index.html
}

# Default: reverse proxy to code-server running on loopback
handle {
	reverse_proxy 127.0.0.1:10000
}
